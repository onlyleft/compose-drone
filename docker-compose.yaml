version: "3.3"

services:
  drone:
    image: drone/drone:2.12.1
    networks:
      - traefik_backend
    volumes:
      - data:/data
    environment:
      - DRONE_GITHUB_CLIENT_ID=$DRONE_GITHUB_CLIENT_ID
      - DRONE_GITHUB_CLIENT_SECRET=$DRONE_GITHUB_CLIENT_SECRET
      - DRONE_RPC_SECRET=$DRONE_RPC_SECRET
      - DRONE_SERVER_HOST=$DRONE_SERVER_HOST
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.frontend.rule=Host(`$DRONE_SERVER_HOST`)"
      - "traefik.http.routers.frontend.entrypoints=websecure"
      - "traefik.http.services.frontend.loadbalancer.server.port=9000"
      - "traefik.http.routers.frontend.service=frontend"
      - "traefik.http.routers.frontend.tls.certresolver=leresolver"


networks:
  traefik_backend:
    external: true

volumes:
  data:
